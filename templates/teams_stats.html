<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier League Stats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='teams_stats.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
    <div class="container">
        <div class="switch-container">
            <button id="overall-btn" class="switch-btn">Overall</button>
            <button id="home-btn" class="switch-btn">Home</button>
            <button id="away-btn" class="switch-btn">Away</button>
        </div>

        <div class="gw-selection">
            <label for="start-gw">Start GW:</label>
            <input type="number" id="start-gw" min="1" max="{{ num_gw }}" value="1">
            <label for="end-gw">End GW:</label>
            <input type="number" id="end-gw" min="1" max="{{ num_gw }}" value="{{ num_gw }}">
            <button id="apply-gw">Apply</button>
        </div>

        <h1>Premier League Stats</h1>
        <table class="standings-table">
            <thead>
                <tr>
                    <th title="Team">Team</th>
                    <th title="Matches Played">Played</th>
                    <th title="Goals Scored">Goals</th>
                    <th title="Expected Goals">xG</th>
                    <th title="xG - G">Î” xG</th>
                    <th title="Shots">Shots</th>
                    <th title="Shots in Box">SiB</th>
                    <th title="Shots on Target">SoT</th>
                    <th title="Big Chances">BC</th>
                    <th title="Failed To Score">FTS</th>
                </tr>
            </thead>
            <tbody id="data-table">
            </tbody>
        </table>
    </div>


    <script>
        let currentDataType = 'overall';
        let num_gw;
        function updateTable(data) {
            const tableBody = document.getElementById('data-table');
            tableBody.innerHTML = '';
            data.forEach(function(team) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${team.team}</td>
                    <td>${team.games_played}</td>
                    <td>${team.goals}</td>
                    <td>${team.xg}</td>
                    <td>${team.delta_xg}</td>
                    <td>${team.shots}</td>
                    <td>${team.sib}</td>
                    <td>${team.sot}</td>
                    <td>${team.bc}</td>
                    <td>${team.failed_to_score}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        function fetchAndSendStats(dataType) {
            const startGw = $('#start-gw').val();
            const endGw = $('#end-gw').val();

            $.ajax({
                url: '/get_stats',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    data_type: dataType,
                    start_gw: startGw,
                    end_gw: endGw
                }),
                success: function(response) {
                    updateTable(response['stats']);
                    num_gw=response['num_gw']
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        }

        $(document).ready(function() {
            fetchAndSendStats(currentDataType);
        });
        $('#apply-gw').click(function() {
            fetchAndSendStats(currentDataType);
        })
        $('#overall-btn').click(function() {
            currentDataType = 'overall';
            fetchAndSendStats(currentDataType);
        })
        $('#home-btn').click(function() {
            currentDataType = 'home';
            fetchAndSendStats(currentDataType);
        })
        $('#away-btn').click(function() {
            currentDataType = 'away';
            fetchAndSendStats(currentDataType);
        })

        // gw selection
        $(document).ready(function () {
            $('#start-gw').on('input', function () {
                const startGw = parseInt($(this).val());
                const endGw = parseInt($('#end-gw').val());
                if (startGw <1){
                    $(this).val(1);
                }
                else if (startGw >num_gw)
                {
                    $(this).val(num_gw);
                }
                if (startGw > endGw) {
                    $(this).val(endGw);
                }
            });

            $('#end-gw').on('input', function () {
                const startGw = parseInt($('#start-gw').val());
                const endGw = parseInt($(this).val());
                if (endGw <1){
                    $(this).val(1);
                }
                else if (endGw >num_gw)
                {
                    $(this).val(num_gw);
                }
                if (endGw < startGw) {
                    $(this).val(startGw);
                }
            });
        });

    </script>
</body>
</html>
